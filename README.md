# 基于MapReduce的天文图像叠加

项目报告，2018年8月

## 项目目标

### 问题与目标

斯隆数字化巡天（简称SDSS）是使用位于新墨西哥州阿帕奇点天文台的2.5米口径望远镜进行的红移巡天项目，该项目计划观测25%的天空，获取超过一百万个天体的多色测光资料和光谱数据。测光系统配以分别位于u、g、r、i、z波段的五个滤镜，对`Stripe 82`天区拍摄了相同大小的巨量相互重叠的天文照片。

该项目得到的巨量天文图像存在着如下问题：

* 照片的大小固定，显示的范围固定
* 限制于单张照片曝光以及图像中存在噪声，导致星体模糊或是过暗

本项目致力于在天文望远镜拍摄的图像基础上，通过图像加权叠加等处理，提供更加灵活的范围查询；降低噪声，提供给定范围内更高质量的图像输出。

在查阅相关资料后，小组决定复现`Wiley K`[1]等人所实现的处理系统。论文中提及，该处理系统采用旧的SDSS数据集，通过图像的加权叠加，实现的效果如下（左图为原始图像，右图为处理后的图像）：

<img src="https://raw.githubusercontent.com/Starcutter/CoAddMR/master/images/paper_img.png">

### 主要功能

经过分析，小组完成了如下几点主要的功能：

* 给定查询范围内多张图片的截取与拼接
* 图像加权叠加
* 应用PSF算法减轻天文望远镜拍摄过程中由于运动产生的模糊问题

## 与分布式的关系

### 数据存储

本项目选取了`Stripe 82`天区的数据集，其中赤经（RA）范围在37 ~ 40度之间。总大小约为107GB（bz2压缩）。实验将该数据存储在`HDFS`上，方便后续的`MapReduce`计算过程。

### 叠加计算

本次实验的核心算法为图像的叠加计算，根据论文中提及的算法，小组采用`MapReduce`框架。其中`Map`负责截取给定查询范围与数据集中图片的相交部分，并进行像素级的映射， 生成可供叠加的图片；而`Reduce`则负责图像的叠加工作。具体的原理与设计参见后文。

此外，为了支持并行查询搜索，系统支持多个`Reduce`任务并行。

## 项目设计



## 项目实现

### PSF

简述一下PSF算法。在图片拍摄的过程中会由于运动产生一定的运动模糊，与此同时，泊松效应也会让一些通过凸透镜拍摄的图片，如显微镜，天文望远镜等产生衍射。针对于这样的问题，PSF算法首先对图片进行FFT变换。从效果图中可以看到，原本黑色的图片变成了灰色的图片，上面图片的色彩已经不见了，转而成为图片分界处的清晰勾勒。对于泊松效应产生的光晕式模糊，在这里已经可以被弱化。对于运动轨迹产生的模糊，我们认为他在时域上的变换是如正弦函数波一般有规律的。因此，当他变换到频域谱上的时候，产生的是一种较为独立的波形。当我们提取出此波形，并还原到时域上的时候，我们可以对还原出来的图片做截取工作。换句话说，就是只截取靠近原点部分的波形，而忽略掉由于此波形的移动而变换出来的波形。这样，运动模糊部分的图像就可以被抹去，我们也就达到了还原出相对真实图片的效果。

## 系统的测试与评价



## 总结与展望



## 参考文献

[1] Wiley K, Connolly A, Gardner J, et al. Astronomy in the cloud: using mapreduce for image co-addition[J]. Publications of the Astronomical Society of the Pacific, 2011, 123(901): 366. 